#This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License 
#<http://creativecommons.org/licenses/by-nc/4.0/> by Philip Collender, Christopher Hoover, Howard Chang,
#and Justin Remais. This work was supported in part by the National Institutes of Health/National Science 
#Foundation Ecology of Infectious Disease program funded by the Fogarty International Center (grant R01TW010286), 
#the National Institute of Allergy and Infectious Diseases (grant K01AI091864), and the National Science Foundation 
#Water Sustainability and Climate Program (grant 1360330).

#Per the terms of this license, if you are making derivative use of this work, you must identify that your work is a derivative work, 
#give credit to the original work, provide a link to the license, and indicate changes that were made.

model{

#Observation Level
for (i in 1:Nobs){
	#Uncertainties
	ln_Conc[i]~dnorm(ln_concmu[i], concPrec[i])
	
	#Interrelationships
	ln_concmu[i]<-ln_Conc0[Exp[i]]+log(alpha[Exp[i]]*exp(-k1[Exp[i]]*Time[i])+(1-alpha[Exp[i]])*exp(-k2[Exp[i]]*Time[i]))+ErrC[i]
	
	ErrC[i]~dnorm(0,1.E-1)
	}
#Experiment Level
for (j in 1:Nexps){
	#Uncertainties
	#Make mu.ln_Conc0 and tau.ln_Conc0 fixed	
	ln_Conc0[j]~dnorm(mu.ln_Conc0[j], tau.ln_Conc0[j])
		
	#Interrelationships
	k1[j]<-k1_20*exp(lambda1*(Temp[j]-20))+Errk1[j]
	k2[j]<-k2_20*exp(lambda2*(Temp[j]-20))+Errk2[j]
	
	Errk1~dnorm(mu.Errk1[Stud[j]],1.E-1)
	Errk2~dnorm(mu.Errk2[Stud[j]],1.E-1)
	}
for (j in 1:Nexpsbiph){
	alpha[j]~dbeta(alpha.alpha[Stud[j]], beta.alpha[Stud[j]])
	}
for (j in Monoexpstart:Nexps){
	alpha[j]~dbern(theta.alpha[Stud[j]])
	}

#Study level priors
for (k in 1:Nstud){
	muErrk1[k]~dnorm(0,1.E-3)
	muErrk2[k]~dnorm(0,1.E-3)
	}
for (k in 1:NStudBiph){
	alpha.alpha[k]~dunif(1,20)
	beta.alpha[k]~dunif(1,20)
	}
for (k in Monostudstart:Nstud){
	theta.alpha[k]~dbeta(1,1)
	}

#Universal priors	
k1_20~dnorm(0,1.E-6)
k2_20<-k1_20-delt
delt<-exp(delta)
delta~dnorm(0,1.E-6)
lambda1~dnorm(0,1.E-6)
lambda2~dnorm(0,1.E-6)
}

